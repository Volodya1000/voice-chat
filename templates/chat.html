{% extends "base.html" %}
{% block title %}Чаты{% endblock %}
{% block body %}
<div class="layout">
    <aside class="sidebar">
        <h3>Чаты</h3>
        <ul class="chat-list">
            {% for c in chats %}
                <li class="chat-item {% if selected_chat and c.id == selected_chat %}active{% endif %}">
                    <a href="/chats/{{c.id}}">{{c.title}}</a>
                    <div class="meta">{{c.created_at.strftime("%Y-%m-%d %H:%M:%S")}}</div>
                </li>
            {% endfor %}
        </ul>

        <form method="post" action="/chats/new" class="new-chat-form">
            <input name="title" placeholder="Новый чат" required/>
            <button type="submit">Создать</button>
        </form>

        <a href="/logout">Выйти</a>
    </aside>

    <main class="chat-area">
        {% if selected_chat %}
            <div class="messages">
                {% for m in messages %}
                    <div class="message {{ m.message_type.value }}">
                        <div class="m-meta">
                            <strong>{{ m.message_type.value }}</strong>
                            <span class="time">{{ m.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</span>
                        </div>
                        <div class="m-body">{{ m.content }}</div>
                    </div>
                {% endfor %}
            </div>

            <form method="post" action="/chats/{{selected_chat}}/send" class="send-form">
                <input name="content" placeholder="Введите сообщение..." required/>
                <button type="submit">Отправить</button>
            </form>
        {% else %}
            <div class="empty">Выберите чат слева или создайте новый.</div>
        {% endif %}
    </main>
</div>
{% endblock %}
