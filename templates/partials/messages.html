<div class="messages" id="message-list">

{% for m in messages %}
  {#
  Выбираем строковое представление типа сообщения.
  Поскольку MessageDTO.message_type — это MessageTypeStr, который наследует str,
  мы можем использовать его напрямую для получения "user" или "model".
  #}
  {% set mt = m.message_type.value %}

  <div class="message {{ mt }}">
    <div class="m-meta">
      <strong>{{ mt }}</strong>
      <span class="time">
        {# Форматирование времени #}
        {% if m.created_at is string %}
          {{ m.created_at }}
        {% else %}
          {{ m.created_at.strftime("%Y-%m-%d %H:%M:%S") }}
        {% endif %}
      </span>
    </div>
    <div class="m-body">{{ m.content }}</div>
  </div>
{% endfor %}

</div>